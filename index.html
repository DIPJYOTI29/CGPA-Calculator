<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CGPA Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #ff7eb3, #6a11cb, #2575fc);
      background-size: 400% 400%;
      animation: gradientBG 12s ease infinite;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      color: #f5f5f5;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      margin-top: 40px;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0px 8px 25px rgba(0, 0, 0, 0.25);
      width: 90%;
      max-width: 850px;
    }

    h1 {
      text-align: center;
      color: #00d9ff;
      margin-bottom: 20px;
      font-weight: 700;
      text-shadow: 0 0 8px rgba(0, 217, 255, 0.6);
    }

    button {
      font-family: inherit;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      padding: 10px 16px;
      margin: 6px;
      background: #00d9ff;
      color: #0f0f0f;
    }

    button:hover {
      background: #00ffae;
      color: #0f0f0f;
      transform: translateY(-2px);
      box-shadow: 0 0 12px rgba(0, 217, 255, 0.8);
    }

    #semesterTable {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    #semesterTable th, #semesterTable td {
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px;
      text-align: center;
    }

    #semesterTable th {
      background: rgba(0, 0, 0, 0.4);
      color: #00d9ff;
      font-weight: 600;
    }

    #semesterTable td input {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      padding: 5px;
      color: #f5f5f5;
    }

    #result {
      margin-top: 20px;
      text-align: center;
      font-size: 1.3em;
      color: #00ffae;
      font-weight: bold;
      text-shadow: 0 0 6px rgba(0,255,174,0.6);
    }

    .chart-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }

    canvas {
      max-width: 400px;
      max-height: 400px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      padding: 10px;
    }

    .user-info {
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      gap: 20px;
    }

    .user-info input {
      flex: 1;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 6px;
      padding: 8px;
      color: #f5f5f5;
      text-transform: capitalize; /* Auto-capitalize first letter */
    }
  </style>
</head>
<body>
  <div class="container" id="content">
    <h1>CGPA Calculator</h1>

    <!-- User Info Section -->
    <div class="user-info">
      <input type="text" id="studentName" placeholder="Enter Your Name">
      <input type="text" id="rollNo" placeholder="Enter Roll No.">
    </div>

    <table id="semesterTable">
      <thead>
        <tr>
          <th>Semester</th>
          <th>SGPA</th>
          <th>Total Credits</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="number" min="1" value="1" /></td>
          <td><input type="number" min="0" max="10" step="0.01" /></td>
          <td><input type="number" min="1" /></td>
          <td><button onclick="removeRow(this)">X</button></td>
        </tr>
      </tbody>
    </table>
    <button onclick="addRow()">âž• Add Semester</button>
    <button onclick="calculateCGPA()">ðŸ“Š Calculate CGPA</button>
    <button onclick="resetTable()">â™» Reset</button>
    <button onclick="downloadPDF()">â¬‡ Download</button>

    <div id="result" style="display:none;"></div>
    <div class="chart-container">
      <canvas id="cgpaChart"></canvas>
    </div>
  </div>

  <script>
    let semesterCounter = 1;
    let chart;

    window.onload = function() {
      window.addRow = function() {
        semesterCounter++;
        const table = document.getElementById("semesterTable").getElementsByTagName("tbody")[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
          <td><input type="number" min="1" value="${semesterCounter}" /></td>
          <td><input type="number" min="0" max="10" step="0.01" /></td>
          <td><input type="number" min="1" /></td>
          <td><button onclick="removeRow(this)">X</button></td>
        `;
      }

      window.removeRow = function(button) {
        const row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
      }

      window.calculateCGPA = function() {
        const rows = document.querySelectorAll("#semesterTable tbody tr");
        let totalCredits = 0, weightedSum = 0;
        let sgpaData = [];
        let labels = [];

        rows.forEach((row, index) => {
          const sgpa = parseFloat(row.cells[1].querySelector("input").value);
          const credits = parseInt(row.cells[2].querySelector("input").value);

          if (!isNaN(sgpa) && !isNaN(credits)) {
            weightedSum += sgpa * credits;
            totalCredits += credits;
            sgpaData.push(credits);
            labels.push(`Sem ${index+1}`);
          }
        });

        if (totalCredits > 0) {
          const cgpa = (weightedSum / totalCredits).toFixed(2);
          document.getElementById("result").innerHTML =
            `ðŸŽ“ Your CGPA is: <span style="color:#00ffae;">${cgpa}</span> (â‰ˆ ${(cgpa * 9.5).toFixed(2)}%)`;
          document.getElementById("result").style.display = "block";

          drawChart(labels, sgpaData);
        } else {
          alert("âš  Please fill in all SGPA and Credit fields!");
        }
      }

      window.resetTable = function() {
        const tbody = document.getElementById("semesterTable").getElementsByTagName("tbody")[0];
        tbody.innerHTML = `
          <tr>
            <td><input type="number" min="1" value="1" /></td>
            <td><input type="number" min="0" max="10" step="0.01" /></td>
            <td><input type="number" min="1" /></td>
            <td><button onclick="removeRow(this)">X</button></td>
          </tr>
        `;
        semesterCounter = 1;
        document.getElementById("result").style.display = "none";
        if (chart) chart.destroy();
      }

      function drawChart(labels, data) {
        const ctx = document.getElementById("cgpaChart").getContext("2d");
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: "pie",
          data: {
            labels: labels,
            datasets: [{
              label: "Credit Contribution",
              data: data,
              backgroundColor: [
                "#ff6384","#36a2eb","#ffcd56","#4bc0c0",
                "#9966ff","#ff9f40","#00d9ff","#00ffae"
              ],
              borderColor: "#fff",
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: "bottom",
                labels: { color: "#f5f5f5" }
              }
            }
          }
        });
      }

      window.downloadPDF = function() {
        const element = document.getElementById("content");

        // Insert name, roll no, and date before export
        const name = document.getElementById("studentName").value || "Not Provided";
        const roll = document.getElementById("rollNo").value || "Not Provided";
        const today = new Date().toLocaleDateString();

        const header = document.createElement("div");
        header.innerHTML = `<h3 style="color:#00ffae; text-align:center; margin-bottom:20px;">
          Name: ${name} &nbsp;&nbsp; | &nbsp;&nbsp; Roll No: ${roll} <br> Date: ${today}
        </h3>`;
        element.insertBefore(header, element.firstChild);

        // Resize chart for PDF only (smaller size)
        const chartCanvas = document.getElementById("cgpaChart");
        const originalWidth = chartCanvas.style.width;
        const originalHeight = chartCanvas.style.height;

        chartCanvas.style.width = "250px";
        chartCanvas.style.height = "250px";
        if (chart) chart.resize();

        const opt = {
          margin: 0.5,
          filename: "cgpa_calculator.pdf",
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: "in", format: "a4", orientation: "portrait" }
        };

        html2pdf()
          .set(opt)
          .from(element)
          .save()
          .then(() => {
            // Remove header after saving
            element.removeChild(header);

            // Revert chart size after PDF generation
            chartCanvas.style.width = originalWidth;
            chartCanvas.style.height = originalHeight;
            if (chart) chart.resize();
          });
      }
    }
  </script>
</body>
</html>

